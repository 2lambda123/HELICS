
FIND_PACKAGE(Java REQUIRED)
FIND_PACKAGE(JNI REQUIRED)
INCLUDE(UseJava)
INCLUDE(UseSWIG)
INCLUDE_DIRECTORIES(${JAVA_INCLUDE_PATH})
INCLUDE_DIRECTORIES(${JAVA_INCLUDE_DIRS})
INCLUDE_DIRECTORIES(${JNI_INCLUDE_DIRS})

SET(CMAKE_SWIG_FLAGS "")

SET_PROPERTY(SOURCE ../helics.i PROPERTY SWIG_MODULE_NAME JNIhelics)

SWIG_ADD_LIBRARY(JNIhelics TYPE MODULE LANGUAGE java SOURCES ../helics.i)

SWIG_LINK_LIBRARIES(JNIhelics helicsSharedLib)
SWIG_LINK_LIBRARIES(JNIhelics ${JAVA_LIBRARIES})


set_target_properties (JNIhelics PROPERTIES FOLDER interfaces)

if (APPLE)

    # SET_TARGET_PROPERTIES(helicsSharedLib PROPERTIES MACOSX_RPATH TRUE)
    # SET_TARGET_PROPERTIES(helicsSharedLib PROPERTIES CMAKE_INSTALL_RPATH_USE_LINK_PATH TRUE)
    
    # SET_TARGET_PROPERTIES(_helics PROPERTIES MACOSX_RPATH TRUE)
    # SET_TARGET_PROPERTIES(_helics PROPERTIES CMAKE_INSTALL_RPATH_USE_LINK_PATH
    # SET_TARGET_PROPERTIES(helics PROPERTIES INSTALL_RPATH "@loader_path/../../..")
    
else()

    # SET_TARGET_PROPERTIES(_helics PROPERTIES INSTALL_RPATH "${CMAKE_INSTALL_PREFIX}/lib")
    # SET_TARGET_PROPERTIES(_helics PROPERTIES INSTALL_RPATH_USE_LINK_PATH TRUE)

endif()

configure_file(${PROJECT_SOURCE_DIR}/config/MakeJarCMakeLists.txt.in ${CMAKE_CURRENT_BINARY_DIR}/CMakeLists.txt @ONLY)

ADD_CUSTOM_COMMAND(
    TARGET "JNIhelics" POST_BUILD
    COMMAND ${CMAKE_COMMAND}
    ARGS " -D ADDITIONAL_JAR_FILES=$<TARGET_FILE:helicsSharedLib> ."
    WORKING_DIRECTORY "${CMAKE_CURRENT_BINARY_DIR}"
)

ADD_CUSTOM_COMMAND(
    TARGET "JNIhelics" POST_BUILD
    COMMAND ${CMAKE_COMMAND}
    ARGS " --build ." 
    WORKING_DIRECTORY "${CMAKE_CURRENT_BINARY_DIR}"
    COMMENT "Building jar file" 
)
